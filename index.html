<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Traffic Flows VBZ</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />


<!--- libraries -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css' rel='stylesheet' />

  <link rel="stylesheet" type="text/css" href="styles/styles-vbz.css">

  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>


<body>

<!--- banner-->
  <div class="bannerimage">
    <div class="bannertext">
      <h1>Verkehrsflüsse VBZ</h1>
    </div>
  </div>


<!--- map object-->

<div id='map'></div>
<div id='console'>
  <h1>Fahrgastzahlen VBZ 2018</h1>
  <p>Datenherkunft: <a href='https://data.stadt-zuerich.ch/dataset/vbz_fahrgastzahlen_ogd'>Stadt Zürich Open Data:</a> Fahrgastzahlen VBZ</p>
  <div class='session'>
    <h2>Auslastung Fahrzeuge im Durchschnitt</h2>
    <div class='row colors'></div>

    <div class='row'>
      <div class='label perc'>0%</div>
      <div class='label perc'>20%</div>
      <div class='label perc'>40%</div>
      <div class='label perc'>60%</div>
      <div class='label perc'>80%</div>
      <div class='label perc'>100%+</div>
    </div>

    <h2>Anzahl Fahrgäste Total</h2>
    <div class='row'style="margin-bottom: 30px">
      <img class = 'label vol' src="https://bountan.github.io/vbz-flow-concept/images/vol1.png" alt="0-10">
      <img class = 'label vol' src="https://bountan.github.io/vbz-flow-concept/images/vol2.png" alt="11-150">
      <img class = 'label vol' src="https://bountan.github.io/vbz-flow-concept/images/vol3.png" alt="151-500">
      <img class = 'label vol' src="https://bountan.github.io/vbz-flow-concept/images/vol4.png" alt="501-1000">
      <img class = 'label vol' src="https://bountan.github.io/vbz-flow-concept/images/vol5.png" alt="1000+">
    </div>

    <div class='row' >
      <div class='label vol'>0</div>
      <div class='label vol'>10</div>
      <div class='label vol'>150</div>
      <div class='label vol'>500</div>
      <div class='label vol'>1000+</div>
    </div>

    <div class='session' id='sliderbar'>
  <h2>Stunde: <label id='active-hour'>12h</label></h2>
  <input id='slider' class='row' type='range' min='0' max='23' step='1' value='12' />
</div>
  </div>
</div>








<!-- map initialization -->

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYm91bnRhbiIsImEiOiJpSXVpaU1BIn0.pzuLQeLdLb3bRoYeQNc9jA';
    var map = new mapboxgl.Map({
      container: 'map',
      center: [8.539261, 47.376166],
      zoom: 14,
      //minZoom: 12,
      //maxZoom: 16,
      style: 'mapbox://styles/bountan/cjv50ji2u02u61fqsyujklffl',
      //maxBounds: [[8.411615, 47.326402], [8.664531, 47.449721]]
    });

// map controls
    var scale = new mapboxgl.ScaleControl({
    maxWidth: 150,
    unit: 'metric'
    });
    map.addControl(scale);

    map.addControl(new mapboxgl.FullscreenControl());

//NEW MAP
// based on earthquakes

map.on('load', function() {
  map.addLayer({
    id: 'vbzjson',
    type: 'line',
    source: {
      type: 'geojson',
      data: 'https://bountan.github.io/vbz-flow-concept/data/vbz_test1.geojson'
    },
    paint: {
        'line-width': [
          'interpolate', ['linear'], ['zoom'],
            13, ['/',   ['step',
                  ['get', 'occsum'],
                  2, 0,
                  4, 15,
                  6, 150,
                  10, 500,
                  14, 1000,
                  18
                ], 20],
            15, ['/', ['step',
                  ['get', 'occsum'],
                  2, 0,
                  4, 15,
                  6, 150,
                  10, 500,
                  14, 1000,
                  18
                ], 0.75],
          ],
      'line-color': [
      'step',
      ['get', 'loadmean'],
      '#328abf', 0.2,
      '#68c4a7', 0.4,
      '#e1e85d', 0.6,
      '#faac5f', 0.8,
      '#d63e4f'
      ],
    },

    filter: ['==', ['get', 'time'], 12]

  });


  document.getElementById('slider').addEventListener('input', function(e) {
  var hour = parseInt(e.target.value);

  // update the map
  map.setFilter('vbzjson', ['==', ['get', 'time'], hour]);

  // converting 0-23 hour to AMPM format
  // var ampm = hour >= 12 ? 'PM' : 'AM';
  // var hour12 = hour % 12 ? hour % 12 : 12;

  // update text in the UI
  document.getElementById('active-hour').innerText = hour +'h';
});

});

</script>

</body>

</html>
